#include <iostream>

#include <fstream>

#include <ctime>

#include <cstring>

#include <cmath>

#include <cstdlib>

#define epsilon 0.0001



using namespace std;


double func(double r0, double PVi, double PMTi, int n)
{
return	n*log(1+r0)+ log(PMTi-PVi*r0)-log(PMTi);

}


double  derivfunc(double r0, double PVi,double PMTi,int n)
{
return  (n/(1+r0))+ (-(PVi)/(PMTi-PVi*r0));
}



double newtonRaphson(double r0, double PVi, double PMT, int n)
{
      double  h = func(double r0, double PVi, double PMT, int n) / derivFunc(double r0, double PVi, double PMT, int n);
 while (abs(h) >= epsilon)
 {
     h = func(double r0, double PVi, double PMTi, int n)/derivFunc(double r0, double PVi, double PMTi, int n);

     r0 = r0- h;
 }
	
}


int main()



{


    srand (( unsigned ) time (0));


	int n;



    double  PVi,PMTi,r1,freq,monthi,yeari;



cout<<"Input the present value: ";
cin>>PVi;cout<<endl;

cout<<"Input the Installment value: ";
cin>>PMTi;cout<<endl;

cout<<"Input frequency (1=annually, 2=semi-anually,4=quarterly,12=monthly): ";
cin>>freq;cout<<endl;


cout<<"Input number of Periods: ";
cin>>n;cout<<endl;

cout<<"Input your starting month: ";
cin>>monthi;cout<<endl;


cout<<"Input your starting year: ";
cin>>yeari;cout<<endl;

double r0=0.0001;
r1= newtonRaphson(r0);

double  PV[n+1], closingbal[n], interest[n], principal[n], r, periodic, per_year[n], per_month[n];


r= (r1*freq)*100;

periodic= (r1*100);


PV[1]=PVi;



per_month[1]=monthi;


per_year[1]=yeari;




	for (int i=1;i<=n;i++)

  {


  interest[i]=(periodic/100)*PV[i];

  principal[i]= PMTi-interest[i];


  closingbal[i]=PV[i]-principal[i];


	PV[i+1]=closingbal[i];


	per_year[i+1]=per_year[i];


	per_month[i+1]=per_month[i]+(12/freq);



	if (per_month[i+1]>12)


	{





                per_month[i+1]=per_month[i+1]-12;



		per_year[i+1]=per_year[i+1]+1;





	}







}




  ofstream myfile3;


  myfile3.open ("newtonraphson.csv");



  myfile3 << "Period#, Date, Opening Balance, Principal, Periodic Interest Rate, Interest, Installment, Closing Balance \n";



  for (int i=1; i<=n;i++)




  {





  myfile3<<i<<","<<per_month[i]<<"/"<<per_year[i]<<","<<PV[i]<<","<<principal[i]<<","<<periodic<<"%"<<","<<interest[i]<<","<<PMTi<<","<<closingbal[i]<<endl;





  }







  myfile3.close();







}



}
